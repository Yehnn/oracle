# 备份恢复

## 实验介绍

### 实验内容



### 实验知识点

+ ​


## 概述

备份包括逻辑备份和物理备份：

- 逻辑备份是一个导出的操作，它会去查询数据库对象（比如表，用户，存储过程等），然后将创建数据对象和数据的命令写到一个导出转储文件中，要恢复时直接执行导入，就回去读取转储文件中的命令并执行。
- 物理备份是转储的实际文件，比如控制文件，数据文件等等。

## 逻辑备份与恢复

逻辑备份与恢复使用的是 `Data Pump Export` 和 `Data Pump Import` 工具。

这里以导出 

### 前期准备

在开始进行导出导入之前，我们需要做如下准备：

- 创建一个目录用来存放日志和转储文件。（也可不创建，直接使用这个目录 `$ORACLE_BASE/admin/<database_name>/dpdump` ）
- 在 Oracle 内创建一个指向该目录的指针。
- 为执行备份的用户添加该目录的读写权限。

首先用 sqlplus 登录进 system 用户：

```bash
$ sqlplus system/Syl12345
```

然后创建一个指向该目录的指针：

```sql
SQL> create directory dpd as '<oracle_base>/admin/xe/dpdump';
```

> 上面的 `<oracle_base>` 替换成自己的 `ORACLE_BASE` 目录。可以在终端使用命令 `echo $ORACLE_BASE` 查看。







[expdp 命令行输入参数](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sutil/oracle-data-pump-export-utility.html#GUID-33880357-06B1-4CA2-8665-9D41347C6705)



[impdp 命令行输入参数](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sutil/datapump-import-utility.html#GUID-BA74D4F6-2840-4002-A673-0A7D9CBB3D78)

## 物理备份与恢复

### RMAN

RMAN （Recovery Manage）是一个备份工具。它有两种跟踪备份的方法：

- 通过备份数据库的控制文件
- 通过另一个数据库的恢复目录

通常我们将执行备份和还原操作的数据库称为目标数据库。更多有关 RMAN 的介绍可参考 [RMAN Backup Concepts](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/bradv/rman-backup-concepts.html#GUID-B3380142-ABCD-437F-9E06-B219D74E6738) 。

#### 初始化参数



#### 登入目标数据库

使用如下语句可以登入本地数据库实例：

```bash
$ rman target /
```

> 是以 `sysdba` 权限的用户身份登入的。

登入进去过后也可以执行 sql 语句，比如查询表空间有哪些：

```sql
RMAN> select * from v$tablespace;

       TS# NAME                           INC BIG FLA ENC     CON_ID
---------- ------------------------------ --- --- --- --- ----------
         1 SYSAUX                         YES NO  YES              0
         0 SYSTEM                         YES NO  YES              0
         2 UNDOTBS1                       YES NO  YES              0
         4 USERS                          YES NO  YES              0
         3 TEMP                           NO  NO  YES              0
         5 SYLTP1                         YES NO  YES              0
         9 TMP_SP1                        NO  NO  YES              0
```

RMAN 有许多可用命令，参见 [About RMAN Commands](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/rcmrf/about-rman-commands.html#GUID-0385D88E-6D36-41AC-BEA0-DD7F5C97D253) 。










## 总结

