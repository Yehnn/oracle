http://study.163.com/course/introduction.htm?courseId=1002900007#/courseDetail?tab=1 章节 11

# 表

## 实验介绍

### 实验内容



### 实验知识点

- 常用数据类型
- 表的创建
- 表的重命名
- 截断表
- 表的复制
- 表的删除
- 修改表的结构

## 常用数据类型

以下是介绍一些我们最常用的数据类型：

- 字符串：使用 `VARCHAR2` 描述（其他数据库用 VARCHAR）。例如姓名，地址等。
- 数字：使用 `NUMBER` 描述。如果描述小数使用 `NUMBER(m,n)` ，其中 `n` 是小数位，`m-n` 是整数位。也可以用 `INT` 描述整数，`FLOAT` 描述小数。
- 日期：使用 `DATE` 描述。Oracle 里的 DATE 包含有日期时间。其他数据库一般 DATE 只是日期，DATETIME 才表示日期时间。
- 大文本数据：使用 `GLOB` 描述。最多可以保存 `4G` 的文字信息。

想了解更多数据类型可参考[Oracle SQL 数据类型](https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sqlrf/Data-Types.html#GUID-A3C0D836-BADB-44E5-A5D4-265BA5968483)

## 创建表

### 普通创建

语法：

```sql
CREATE TABLE 表名称(
	列名称		类型		[DEFAULT 默认值]
	列名称		类型		[DEFAULT 默认值]
	...
)
```

例如：

注：前面的 `SQL>` 不用输入，只是为了说明是在 SQL 命令行输入内容。

```sql
SQL> CREATE TABLE student(
  id		NUMBER,
  name		VARCHAR2(20),
  age		number(3),
  birthday	DATE	DEFAULT SYSDATE,
  note		CLOB
);
```

查看是否已经创建好 student 表：

```sql
SQL> select * from tab where tname='STUDENT';
```

查看 student 表结构：

```sql
SQL> desc student;
```

我们可以向其中插入数据：

```sql
SQL> INSERT INTO student(id,name,age,birthday,note) VALUES (1,'syl',19,TO_DATE('1999-01-01','yyyy-mm-dd'),'note test');
SQL> INSERT INTO student(id,name,age,birthday,note) VALUES (2,'lou',21,TO_DATE('1997-01-01','yyyy-mm-dd'),'note test');
```

查看我们插入的数据：

```sql
SQL> select * from student;
```

### 通过查询结果创建

例如我们查询出 student 表中 name 字段值为 syl 的记录，通过查询结果创建一个 名叫 syl_stu 的表。

```sql
SQL> create table syl_stu as select * from student where name='syl';
SQL> select * from syl_stu;
```

## 表的重命名

```sql
SQL> RENAME student TO stu;
```

我们使用数据字典查询一个用户全部的数据表，可以发现表已经被更名：

```sql
SQL> select * from user_tables;
```

列出数据库表对象的全部信息内容，例如名称，存储情况等。

>  数据字典：记录所有对象的信息。
>
> - 用户级别：user_*，指一个用户可以使用的数据字典。
> - 管理员级别：dba_*，指由数据库管理员使用的数据字典。
> - 全部级别：all_* ，指不管是用户还是管理员都可以使用。

## 删除表内容

首先我们来进行普通的删除操作。

```sql
SQL> commit; 
SQL> delete from stu;
```

查看表内容会发现已经被清空。但是在我们执行 `rollback` 回滚操作过后会发现数据又被恢复：

```sql
SQL> rollback;
SQL> select * from stu;
```

> rollback 会恢复到上一次 commit 的数据。

上面的删除操作并没有立即将表所占的资源（约束，索引等）立即释放掉，如果想要完全删除，就需要使用 `truncate` ，也叫做截断表的操作。例如：

```sql
SQL> truncate table stu;
```

这个时候再执行回滚操作，会发现数据无法恢复：

```sql
SQL> rollback;
SQL> select * from stu;
```

## 表的删除

例如我们要删除 `syl_stu` 这张表，可以使用如下命令：

```sql
SQL> drop table syl_stu;
```

> 注意：如果删除的表是含有约束的父表的话，将会报错。此时需要使用 `drop table <table_name> cascade constraints` 删除。

## 闪回技术

闪回操作也就是一个恢复操作，当我们不小心使用 `drop table` 删除了一张表的时候，实际上和 windows 删除文件类似，这个表被放到了回收站中，并且为了标记出回收站的内容不是空的，会在表的数据字典中生成 `BIN` 开头的内容。我们可以使用闪回闪回技术 `FLASHBACK` 进行恢复。

system 表空间没有回收站功能。

```sql
SQL> show recyclebin;
select * from user_recyclebin;
```





## 修改表结构

### 增加列 ADD

添加一列没有设置默认值



添加一列设置了默认值



### 修改表中的数据列 MODIFY



### 删除列 DROP COLUMN





复制表结构





## 总结

